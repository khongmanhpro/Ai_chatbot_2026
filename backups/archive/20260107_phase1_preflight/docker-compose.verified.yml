name: lightrag
services:
  lightrag:
    build:
      context: /Volumes/data/123/RAG/LightRAG
      dockerfile: Dockerfile
      tags:
        - ghcr.io/hkuds/lightrag:latest
    container_name: lightrag
    depends_on:
      neo4j:
        condition: service_started
        required: true
    environment:
      AUTH_ACCOUNTS: admin:admin123
      CHUNK_OVERLAP_SIZE: "200"
      CHUNK_SIZE: "1200"
      CHUNK_TOP_K: "8"
      COSINE_THRESHOLD: "0.3"
      EMBEDDING_BATCH_NUM: "10"
      EMBEDDING_BINDING: openai
      EMBEDDING_BINDING_API_KEY: sk-lCVjfE29rhXjROU60N80rdjS3coChmGkDuZ7UERuIHp0Mg4F
      EMBEDDING_BINDING_HOST: https://gpt1.shupremium.com/v1
      EMBEDDING_DIM: "3072"
      EMBEDDING_FUNC_MAX_ASYNC: "32"
      EMBEDDING_MODEL: text-embedding-3-large
      EMBEDDING_SEND_DIM: "false"
      EMBEDDING_TIMEOUT: "60"
      EMBEDDING_TOKEN_LIMIT: "8192"
      ENABLE_LLM_CACHE: "true"
      ENABLE_LLM_CACHE_FOR_EXTRACT: "true"
      ENTITY_TYPES: '["Policy", "Coverage", "Exclusion", "Benefit", "Condition", "ClaimProcess", "Premium", "Deductible", "Definition", "Regulation"]'
      FORCE_LLM_SUMMARY_ON_MERGE: "5"
      HOST: 0.0.0.0
      INPUT_DIR: ./data/inputs
      KG_CHUNK_PICK_METHOD: VECTOR
      LIGHTRAG_API_KEY: sk-c61197f847cc4682a91ada560bbd7119
      LIGHTRAG_DOC_STATUS_STORAGE: JsonDocStatusStorage
      LIGHTRAG_GRAPH_STORAGE: Neo4JStorage
      LIGHTRAG_KV_STORAGE: JsonKVStorage
      LIGHTRAG_VECTOR_STORAGE: NanoVectorDBStorage
      LLM_BINDING: openai
      LLM_BINDING_API_KEY: sk-lCVjfE29rhXjROU60N80rdjS3coChmGkDuZ7UERuIHp0Mg4F
      LLM_BINDING_HOST: https://gpt1.shupremium.com/v1
      LLM_MODEL: gpt-4o-mini
      LLM_TIMEOUT: "120"
      LOG_LEVEL: INFO
      MAX_ASYNC: "16"
      MAX_ENTITY_TOKENS: "4000"
      MAX_PARALLEL_INSERT: "3"
      MAX_RELATION_TOKENS: "4000"
      MAX_TOTAL_TOKENS: "10000"
      MIN_RERANK_SCORE: "0.0"
      NEO4J_DATABASE: neo4j
      NEO4J_KEEP_ALIVE: "true"
      NEO4J_MAX_CONNECTION_POOL_SIZE: "100"
      NEO4J_PASSWORD: Khongmanh@2001@
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USERNAME: neo4j
      OPENAI_LLM_MAX_COMPLETION_TOKENS: "4000"
      OPENAI_LLM_TEMPERATURE: "0.7"
      PORT: "9621"
      RELATED_CHUNK_NUMBER: "5"
      RERANK_BINDING: jina
      RERANK_BINDING_API_KEY: jina_52b46a04e0874e2daca868cb4e53e3d7SmUG3zmmoCKgG4G1upv2ytgBq2vA
      RERANK_BINDING_HOST: https://api.jina.ai/v1/rerank
      RERANK_BY_DEFAULT: "True"
      RERANK_MODEL: jina-reranker-v2-base-multilingual
      SUMMARY_LANGUAGE: Vietnamese
      SUMMARY_MAX_TOKENS: "1500"
      TIKTOKEN_CACHE_DIR: ./data/tiktoken
      TOKEN_SECRET: 2f8c14e9d5a7b6c3e9f8a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2
      TOP_K: "10"
      VERBOSE: "False"
      WEBUI_DESCRIPTION: Specialized Graph-RAG for Insurance Industry with Neo4j
      WEBUI_TITLE: Insurance Graph KB
      WORKING_DIR: ./data/rag_storage
      WORKSPACE: insurance_graph_kb
    extra_hosts:
      - host.docker.internal=host-gateway
    image: ghcr.io/hkuds/lightrag:latest
    networks:
      default: null
    ports:
      - mode: ingress
        target: 9621
        published: "9621"
        protocol: tcp
    restart: unless-stopped
    volumes:
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/rag_storage
        target: /app/data/rag_storage
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/inputs
        target: /app/data/inputs
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/config.ini
        target: /app/config.ini
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/.env
        target: /app/.env
        bind:
          create_host_path: true
  neo4j:
    container_name: neo4j
    environment:
      NEO4J_AUTH: neo4j/Khongmanh@2001@
      NEO4J_PLUGINS: '["apoc"]'
    image: neo4j:5.26.0
    networks:
      default: null
    ports:
      - mode: ingress
        target: 7474
        published: "7474"
        protocol: tcp
      - mode: ingress
        target: 7687
        published: "7687"
        protocol: tcp
    restart: unless-stopped
    volumes:
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/neo4j/data
        target: /data
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/neo4j/logs
        target: /logs
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/neo4j/conf
        target: /conf
        bind:
          create_host_path: true
      - type: bind
        source: /Volumes/data/123/RAG/LightRAG/data/neo4j/plugins
        target: /plugins
        bind:
          create_host_path: true
networks:
  default:
    name: lightrag_default
